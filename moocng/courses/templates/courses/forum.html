{% extends "courses/base_course.html" %}
{% load i18n %}
{% block content %}

<script type="text/javascript">
	$(document).ready(function () {
		$(".addButton").click(function(){
			$(".postFrom").toggle();
			$(this).hide();
		});

		$(".cancelPost").click(function(){
			$(".postFrom").toggle();
			$(".addButton").show();
		});

		$(".reply").click(function(){
			$(this).parent().parent().parent().toggleClass('open');
		});

		var load = true;
		var page = 10;
		$(window).scroll(function() {
		    if($(window).scrollTop() + $(window).height() == $(document).height() && load) {
		   		load = false;	
		        $.ajax({
					url : "/course/{{course.slug}}/forum/loadMorePosts/" + page,
			    	success: function(response) {
			    		if(response.trim() != ""){
			    			$(".posts").append(response)
			    			page += 10;
			    			load = true;
			    		}
			    	}
				});
		    }
		});
	});
</script>

<div class="userposts">
	<div class="container">
		<div class="row">
			<div class="col-lg-16 col-md-12 col-sm-8 col-mob-4">
				<div class="panel">
					<div class="header">
						<h3>{% trans "Posts" %}</h3>
						{% if is_teacher or user.is_staff %}
						<input class="addButton pull-right" type="button" value="{% trans "NEW POST" %}">
						{% endif %}
					</div>
					{% if is_teacher or user.is_staff %}
					<form class="postFrom" method="post">
						{% csrf_token %}
						 {{ form }}
						<input class="postButton" type="submit" value="{% trans "Send" %}">
						<span class="cancelPost">{% trans "Cancel" %}</span>
					</form>
					{% endif %}
					<div class="content">
						<div class="posts">
							{% for post in posts %}
								<div class="row post">
									<a href="{{ post.id }}">
										<div class="col-lg-12 col-md-8 col-sm-8 col-mob-4 header">
											<div class="cell">
												<img class="gravatar" src={{ post.avatar}}>
											</div>
											<div class="cell">
											{% autoescape off %}
												<h4>{{ post.title }}</h4>
												<p>{{ post.text }}</p>
											{% endautoescape %}
											</div>
										</div>
										<div class="col-lg-4 col-md-4 col-sm-8 col-mob-4 info">
											<h5>{% trans "Last reply" %}</h5>
											<span class="emailPost">{{post.username}}</span>
											<span class="datePost">
											{% if post.original_date %}
												{{post.original_date}}
											{% else %}
												{{post.date}}
											{% endif %}
										</span>
										</div>
									</a>
								</div>
							{% endfor %}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal hide">
		{% trans "This post has already been shared" %}	
	</div>

</div>

{% endblock %}