{% extends "courses/base_course.html" %}
{% load i18n %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-bg-16 col-md-12 col-sm-8 col-mob-4 syllabus">
            <h3>{% trans "Syllabus" %}</h3>
            <ol>
            {% for unit in unit_list %}
                <li>
                    <a href="{{unit.url}}" class="unit {% if unit.complete %}done{% endif %}">{{unit.title}}</a>
                    <a class="fblike"><img src="{{ STATIC_URL }}img/ECO_icon_gusta_fb.svg"><span></span></a>
                    <a class="gplusone"><img src="{{ STATIC_URL }}img/ECO_icon_gusta_google.svg"><span></span></a>
                {% if unit.questions %}
                    <ol>
                        {% for q in unit.questions %}
                        <li class="{% if q.current %}current{% endif %}{% if q.completed %}done{% endif %}">

                            <a class="kq" href="{{q.url}}">{{q.title}}</a>
                            <a class="fblike"><img src="{{ STATIC_URL }}img/ECO_icon_gusta_fb.svg"><span></span></a>
                            <a class="gplusone"><img src="{{ STATIC_URL }}img/ECO_icon_gusta_google.svg"><span></span></a>

                            {% if q.has_video %}
                                <span><img src="{{ STATIC_URL }}img/ECO_icon_contenido_video.svg">{% trans "Video" %}</span>
                            {% endif %} 

                            {% if q.has_presentation %}
                                <span><img src="{{ STATIC_URL }}img/ECO_icon_contenido_presentacion.svg">{% trans "Presentation" %}</span>
                            {% endif %} 

                            {% if q.has_attachments %}
                                <span><img src="{{ STATIC_URL }}img/ECO_icon_contenido_fichero.svg">{% trans "Attachments" %}</span>
                            {% endif %} 

                            {% if q.has_test %}
                                <span><img src="{{ STATIC_URL }}img/ECO_icon_contenido_tarea-test.svg">{% trans "Test" %}</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ol>
                {% endif %}
                </li>
            {% endfor %}
            </ol>
        </div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
    <script type="text/javascript">
        $(function(){
            var host = window.location.origin;
            $('.syllabus a.unit').each(function(){
                var $fb = $(this).siblings('.fblike').first();
                var $gplus = $(this).siblings('.gplusone').first();
                var url = $(this).attr('href');
                url = url.replace('#!','?_escaped_fragment=')
                /* FB */
                $.getJSON('http://graph.facebook.com/'+host+url,function(data){
                    //console.log(data);
                    $fb.attr("href","http://www.facebook.com/sharer/sharer.php?u="+host+url);
                    $fb.children('span').html(data.shares);
                });
                /* GPLUS */
                $.ajax({
                    cache: false,
                    type: 'POST',
                    url: 'https://clients6.google.com/rpc',
                    data:[{
                        'method': 'pos.plusones.get',
                        'id': 'p',
                        'jsonrpc': '2.0',
                        'key': 'p',
                        'apiVersion': 'v1',
                        'params': {
                            'nolog': true,
                            'id': host+url,
                            'source':'widget',
                            'userId': '@viewer',
                            'groupId': '@self'
                        }
                    }],
                    crossDomain: true,
                    jsonp: true,
                    timeout: 5000,
                    dataType: 'jsonp',
                    contentType: 'application/javascript; charset=utf-8',
                    success: function(data){
                        console.log('YEAH!');
                        console.log(data);
                    },
                    allways: function(data){
                        console.log(data);
                    }
                });
            });
        });
    </script>
{% endblock %}